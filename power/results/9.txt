-- using 1115013950 as a seed to the RNG
-- @(#)9.sql	2.1.8.1
-- TPC-H/TPC-R Product Type Profit Measure Query (Q9)
-- Functional Query Definition
-- Approved February 1998
START TRANSACTION;



select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%tomato%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
COMMIT;
nation	o_year	sum_profit
ALGERIA	1998	261897308.3954
ALGERIA	1997	453402554.7258
ALGERIA	1996	456354887.5814
ALGERIA	1995	461786011.9788
ALGERIA	1994	453435263.5860
ALGERIA	1993	457989587.3864
ALGERIA	1992	464755699.5643
ARGENTINA	1998	282638342.8360
ARGENTINA	1997	470322809.3557
ARGENTINA	1996	468985555.2637
ARGENTINA	1995	464967988.9751
ARGENTINA	1994	471348587.2383
ARGENTINA	1993	465053950.8302
ARGENTINA	1992	471818587.9070
BRAZIL	1998	283729986.4235
BRAZIL	1997	475129182.0043
BRAZIL	1996	468982577.8618
BRAZIL	1995	476535678.7709
BRAZIL	1994	469213809.8079
BRAZIL	1993	479080667.6426
BRAZIL	1992	472892850.0715
CANADA	1998	277968593.3087
CANADA	1997	476331434.6345
CANADA	1996	486043702.1170
CANADA	1995	481072008.8583
CANADA	1994	483630586.1013
CANADA	1993	485343494.6453
CANADA	1992	482112198.0611
CHINA	1998	277396546.2196
CHINA	1997	475786000.4338
CHINA	1996	473520329.7347
CHINA	1995	477668425.8082
CHINA	1994	469290641.7202
CHINA	1993	479661581.6101
CHINA	1992	484959223.0122
EGYPT	1998	274578059.3085
EGYPT	1997	466515366.4171
EGYPT	1996	477016384.6528
EGYPT	1995	461699961.9892
EGYPT	1994	462239432.4776
EGYPT	1993	465007188.3479
EGYPT	1992	461886144.3883
ETHIOPIA	1998	275364223.3245
ETHIOPIA	1997	463454324.5824
ETHIOPIA	1996	464812199.4261
ETHIOPIA	1995	458075768.2813
ETHIOPIA	1994	472860166.3444
ETHIOPIA	1993	472814237.7420
ETHIOPIA	1992	466572338.3625
FRANCE	1998	267455208.4039
FRANCE	1997	457660579.8496
FRANCE	1996	461598403.1677
FRANCE	1995	465611909.4365
FRANCE	1994	472327779.9938
FRANCE	1993	453675914.3508
FRANCE	1992	462420815.0110
GERMANY	1998	273139352.7386
GERMANY	1997	478631965.7797
GERMANY	1996	469682238.7679
GERMANY	1995	467505439.9933
GERMANY	1994	470737214.1662
GERMANY	1993	464563212.0211
GERMANY	1992	470510521.7970
INDIA	1998	282146668.9050
INDIA	1997	482085986.1881
INDIA	1996	485720561.4334
INDIA	1995	490749620.0661
INDIA	1994	492639317.0589
INDIA	1993	490893260.2103
INDIA	1992	479918537.3854
INDONESIA	1998	270493693.8943
INDONESIA	1997	473753614.3971
INDONESIA	1996	472549959.1585
INDONESIA	1995	468403791.7866
INDONESIA	1994	476384282.6814
INDONESIA	1993	463939080.0986
INDONESIA	1992	459405650.7825
IRAN	1998	273841871.8399
IRAN	1997	471715942.2562
IRAN	1996	469974257.8310
IRAN	1995	472765236.9222
IRAN	1994	470125290.2034
IRAN	1993	467636371.3590
IRAN	1992	469309351.2625
IRAQ	1998	277782408.0594
IRAQ	1997	471863311.6076
IRAQ	1996	473157520.8526
IRAQ	1995	470834747.1478
IRAQ	1994	472475340.3337
IRAQ	1993	479541089.1700
IRAQ	1992	476251790.0469
JAPAN	1998	265507238.8518
JAPAN	1997	466493099.9612
JAPAN	1996	475625284.4622
JAPAN	1995	466404337.1867
JAPAN	1994	476361811.3598
JAPAN	1993	466893306.8357
JAPAN	1992	468034216.1516
JORDAN	1998	270071164.3446
JORDAN	1997	466623617.2332
JORDAN	1996	465331923.6844
JORDAN	1995	462745808.4163
JORDAN	1994	468317281.2348
JORDAN	1993	468383455.2713
JORDAN	1992	466025956.5819
KENYA	1998	281450784.8677
KENYA	1997	479130844.3348
KENYA	1996	472947837.4759
KENYA	1995	477664583.2522
KENYA	1994	485324464.6244
KENYA	1993	474416114.3149
KENYA	1992	472257638.7028
MOROCCO	1998	273509133.6615
MOROCCO	1997	476198512.2192
MOROCCO	1996	472547986.9148
MOROCCO	1995	473682160.2284
MOROCCO	1994	480753247.0687
MOROCCO	1993	463253378.1745
MOROCCO	1992	479056781.1130
MOZAMBIQUE	1998	267763997.4832
MOZAMBIQUE	1997	453038315.2739
MOZAMBIQUE	1996	459446579.3316
MOZAMBIQUE	1995	458360216.9172
MOZAMBIQUE	1994	458013642.6311
MOZAMBIQUE	1993	459742744.5746
MOZAMBIQUE	1992	458388885.8105
PERU	1998	266019038.5330
PERU	1997	469805713.8196
PERU	1996	471157601.7536
PERU	1995	470064842.4802
PERU	1994	463479381.6665
PERU	1993	469764308.3900
PERU	1992	464328266.7691
ROMANIA	1998	278615955.5727
ROMANIA	1997	471809728.2715
ROMANIA	1996	483646008.7372
ROMANIA	1995	477461142.0994
ROMANIA	1994	465852180.1035
ROMANIA	1993	475974462.5814
ROMANIA	1992	470900032.5983
RUSSIA	1998	279450921.6686
RUSSIA	1997	480051023.3306
RUSSIA	1996	476987885.5485
RUSSIA	1995	475611606.6021
RUSSIA	1994	471343828.4275
RUSSIA	1993	476317119.3404
RUSSIA	1992	479502645.2888
SAUDI ARABIA	1998	273793537.8499
SAUDI ARABIA	1997	467492767.5804
SAUDI ARABIA	1996	474817956.2486
SAUDI ARABIA	1995	476812880.0387
SAUDI ARABIA	1994	476094001.3087
SAUDI ARABIA	1993	480840424.3368
SAUDI ARABIA	1992	476775219.4574
UNITED KINGDOM	1998	271477881.8002
UNITED KINGDOM	1997	467057691.8212
UNITED KINGDOM	1996	463730444.6092
UNITED KINGDOM	1995	463272583.6833
UNITED KINGDOM	1994	460145379.5184
UNITED KINGDOM	1993	466165877.2704
UNITED KINGDOM	1992	456574297.4893
UNITED STATES	1998	280310369.8012
UNITED STATES	1997	476975770.8390
UNITED STATES	1996	474327365.6057
UNITED STATES	1995	475595844.4960
UNITED STATES	1994	477219368.2423
UNITED STATES	1993	472087845.5476
UNITED STATES	1992	476630249.1872
VIETNAM	1998	275276557.6467
VIETNAM	1997	464178880.4324
VIETNAM	1996	467896208.0619
VIETNAM	1995	465930484.6299
VIETNAM	1994	469704841.2350
VIETNAM	1993	471724030.9569
VIETNAM	1992	459690600.2244
